<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Media share</title>
    <link href="https://vjs.zencdn.net/7.21.1/video-js.css"
          rel="stylesheet"
    />
    <style>
        .vjs-tech {
            pointer-events: none;
        }
    </style>
    <script>
        const PORT = 3002;

        window.onload = () => connect_to_server();

        function connect_to_server() {
            let socket;
            socket = new WebSocket(`ws://localhost:${PORT}`);

            socket.onmessage = (image_source) => {
                console.log('received message:')
                console.log(image_source.data);
                new Emote(image_source.data, DEFAULT_EMOTE_HEIGHT).show();
            };

            socket.onopen = (event) => console.log('connected');
            socket.onclose = (event) => console.log('closed');
            socket.onerror = (event) => console.log('error');
        }

    </script>
</head>
<body>
    <video
            id="player"
            class="video-js"
            width="800"
            height="450"
            data-setup='{
                "controls": true
            }'
            autofocus
    >
        <source src="../events/media/videos/video.mp4" type="video/mp4">
    </video>

    <script src="https://vjs.zencdn.net/7.21.1/video.min.js"></script>
    <script>
        // TODO: more controls -> forward, backward, volume, skip (get next video from server) etc.
        let player = videojs('player', {
            userActions: {
                hotkeys: function(event) {
                    // `space` key = play/pause
                    if (event.which === 32) {
                        console.log('pause button pressed');
                        this.paused() ? this.play() : this.pause();
                    }

                    if (event.which === 65) {
                        console.log('backward button pressed');
                        let new_time = Math.max(this.currentTime()-5, 0);
                        this.currentTime(new_time);
                    }

                    if (event.which === 68) {
                        console.log('forward button pressed');
                        let new_time = Math.min(this.currentTime()+5, this.duration());
                        this.currentTime(new_time);
                    }
                }
            }
        });

        // TODO: timestamps + duration
        player.ready(function() {
            player.controlBar.hide();
            player.bigPlayButton.hide();


            let start = 45,
                duration = player.duration();
            player.currentTime(start);
        });
    </script>
</body>
</html>